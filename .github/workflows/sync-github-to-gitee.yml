name: Sync GitHub to Gitee

on:
  workflow_dispatch:
  schedule:
    # At minute 50 past every 4th hour.
    - cron: "50 */4 * * *"

jobs:
  sync-repos:
    runs-on: windows-latest
    env:
      USER_NAME: "abgox"
      USER_EMAIL: "abgohxf@outlook.com"
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      PAT_TOKEN_GITEE: ${{ secrets.PAT_TOKEN_GITEE }}
    steps:
      - name: Configure Git
        shell: pwsh
        run: |
          git config --global user.name $env:USER_NAME
          git config --global user.email $env:USER_EMAIL

      - name: Checkout
        uses: actions/checkout@v5
        # with:
        #   fetch-depth: 0

      - name: Sync Repos
        shell: pwsh
        run: |
          .\scripts\sync-github-to-gitee.ps1

      - name: Commit and push changes
        shell: pwsh
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add -u
          git commit -m "chore: automatically update some content"
          git push
